#!/usr/bin/env bash
#MISE description="Bump version to the next patch release in Cargo.toml and package.json files"

set -e

# Get current version from the main Cargo.toml
CURRENT_VERSION=$(grep '^version = ' crates/dyndns/Cargo.toml | sed 's/version = "\(.*\)"/\1/')
echo "Current version: $CURRENT_VERSION"

# Parse version parts
IFS='.' read -r MAJOR MINOR PATCH <<< "$CURRENT_VERSION"

# Increment patch version
NEW_PATCH=$((PATCH + 1))
NEW_VERSION="$MAJOR.$MINOR.$NEW_PATCH"

echo "New version: $NEW_VERSION"

# Update dyndns Cargo.toml
sed -i.bak "s/^version = \"$CURRENT_VERSION\"/version = \"$NEW_VERSION\"/" crates/dyndns/Cargo.toml && rm crates/dyndns/Cargo.toml.bak

# Update package.json
sed -i.bak "s/\"version\": \"$CURRENT_VERSION\"/\"version\": \"$NEW_VERSION\"/" webclients/svelte/package.json && rm webclients/svelte/package.json.bak

echo "âœ… Version bumped from $CURRENT_VERSION to $NEW_VERSION"
echo "Files updated:"
echo "  - crates/dyndns/Cargo.toml"
echo "  - webclients/svelte/package.json"